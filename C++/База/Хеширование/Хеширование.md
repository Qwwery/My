
# –ü–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ (—Å –¥–≤–æ–π–Ω—ã–º –º–æ–¥—É–ª–µ–º)

–ü–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ–¥—Å—Ç—Ä–æ–∫, –ø–æ–∏—Å–∫–∞ –ø–∞–ª–∏–Ω–¥—Ä–æ–º–æ–≤, –ø–æ–¥—Å—Ç—Ä–æ–∫ –∏ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–∞–¥–∞—á. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –∑–∞$O(1)$–ø–æ—Å–ª–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

---

## üîπ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞

–î–ª—è —Å—Ç—Ä–æ–∫–∏$s$–¥–ª–∏–Ω—ã$n$, –ø–æ–ª–∏–Ω–æ–º–∏–∞–ª—å–Ω—ã–π —Ö–µ—à –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫:

$$
\text{hash}(s) = \left( \sum_{i=0}^{n-1} s[i] \cdot p^i \right) \mod m
$$

–ì–¥–µ:
- $s[i]$ ‚Äî —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0),
- $p$ ‚Äî **–æ—Å–Ω–æ–≤–∞–Ω–∏–µ** (base),
- $m$ ‚Äî **–º–æ–¥—É–ª—å** (–æ–±—ã—á–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ).

---

## üîπ –ü–æ—á–µ–º—É –Ω—É–∂–Ω–æ –¥–≤–æ–π–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ?

–û–¥–∏–Ω–∞—Ä–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–≤–µ—Ä–∂–µ–Ω–æ **–∫–æ–ª–ª–∏–∑–∏—è–º** ‚Äî —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ö–µ—à. –ß—Ç–æ–±—ã —Å–≤–µ—Å—Ç–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–∫–∏ –∫ –ø—Ä–µ–Ω–µ–±—Ä–µ–∂–∏–º–æ –º–∞–ª–æ–π, –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Ö–µ—à–∞** —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ **–ø–∞—Ä–µ —Ö–µ—à–µ–π**. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–ª–ª–∏–∑–∏–∏ –≤ –¥–≤—É—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∫—Ä–∞–π–Ω–µ –º–∞–ª–∞ (~$10^{-18}$).

---

## üîπ –í—ã–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏                                                          |
| --------------------- | --------------------------------------------------------------------- |
| **–û—Å–Ω–æ–≤–∞–Ω–∏–µ $p$**     | > —Ä–∞–∑–º–µ—Ä –∞–ª—Ñ–∞–≤–∏—Ç–∞, –Ω–µ—á—ë—Ç–Ω–æ–µ. –ü—Ä–∏–º–µ—Ä—ã: `131`, `137`, `257`             |
| **–ú–æ–¥—É–ª–∏ $m_1, m_2$** | –ë–æ–ª—å—à–∏–µ –ø—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞: `1e9+7`, `1e9+9`, `998244353`                  |
| **–ó–Ω–∞—á–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤** | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `0`. –ù–∞–ø—Ä–∏–º–µ—Ä: `'a' ‚Üí 1`, `'A' ‚Üí 27`, `'0' ‚Üí 53` |

> ‚ùó –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —á–µ—Ç–Ω—ã–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è ‚Äî –æ–Ω–∏ —Ö—É–∂–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ö–µ—à–∏.

---

## üîπ –ü—Ä–µ–¥–ø–æ–¥—Å—á—ë—Ç: –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ —Ö–µ—à–∏ –∏ —Å—Ç–µ–ø–µ–Ω–∏

–ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –≤—ã—á–∏—Å–ª—è—Ç—å —Ö–µ—à –ª—é–±–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏, –ø—Ä–µ–¥–ø–æ–¥—Å—á–∏—Ç–∞–µ–º:
- `prefix1[i]`, `prefix2[i]` ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ —Ö–µ—à–∏ –ø–æ –¥–≤—É–º –º–æ–¥—É–ª—è–º,
- `power1[i]`, `power2[i]` ‚Äî —Å—Ç–µ–ø–µ–Ω–∏ –æ—Å–Ω–æ–≤–∞–Ω–∏—è$p^i$–ø–æ –º–æ–¥—É–ª—è–º.

---

## üîπ –§–æ—Ä–º—É–ª–∞ –¥–ª—è —Ö–µ—à–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏

–•–µ—à –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ $s[l..r]$ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ):

$$
\text{hash}(l, r) = \left( \text{pref}[r+1] - \text{pref}[l] \cdot p^{r-l+1} \right) \mod m
$$

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –º–æ–¥—É–ª—è.

---

## üîπ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ C++

```cpp
#include <iostream>
#include <vector>
#include <string>
using namespace std;

const long long MOD1 = 1000000007;
const long long MOD2 = 1000000009;
const long long BASE = 131;

struct DoubleHashedString {
    string s;
    vector<long long> pref1, pref2;
    vector<long long> pow1, pow2;

    DoubleHashedString(const string& str) : s(str) {
        int n = s.size();
        pref1.resize(n + 1, 0);
        pref2.resize(n + 1, 0);
        pow1.resize(n + 1, 1);
        pow2.resize(n + 1, 1);

        // –ü—Ä–µ–¥–ø–æ–¥—Å—á—ë—Ç —Å—Ç–µ–ø–µ–Ω–µ–π
        for (int i = 1; i <= n; ++i) {
            pow1[i] = (pow1[i-1] * BASE) % MOD1;
            pow2[i] = (pow2[i-1] * BASE) % MOD2;
        }

        // –ü—Ä–µ–¥–ø–æ–¥—Å—á—ë—Ç –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã—Ö —Ö–µ—à–µ–π
        for (int i = 0; i < n; ++i) {
            long long c = s[i] - 'a' + 1;  // —Å–∏–º–≤–æ–ª ‚Üí —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 26

            pref1[i+1] = (pref1[i] * BASE + c) % MOD1;
            pref2[i+1] = (pref2[i] * BASE + c) % MOD2;
        }
    }

    // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä—É —Ö–µ—à–µ–π –¥–ª—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ [l, r]
    pair<long long, long long> get_hash(int l, int r) {
        long long h1 = (pref1[r+1] - (pref1[l] * pow1[r - l + 1]) % MOD1 + MOD1) % MOD1;
        long long h2 = (pref2[r+1] - (pref2[l] * pow2[r - l + 1]) % MOD2 + MOD2) % MOD2;
        return {h1, h2};
    }
};
```

---

## üîπ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä 

```cpp
#include <iostream>
#include <vector>
#include <string>
using namespace std;

const long long MOD1 = 1000000007;
const long long MOD2 = 1000000009;
const long long BASE = 131;

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã
vector<long long> pref1, pref2;
vector<long long> pow1, pow2;
string s;

// –ü—Ä–µ–¥–ø–æ–¥—Å—á—ë—Ç
void build_hashes() {
    int n = s.size();
    pref1.assign(n + 1, 0);
    pref2.assign(n + 1, 0);
    pow1.assign(n + 1, 1);
    pow2.assign(n + 1, 1);

    for (int i = 1; i <= n; i++) {
        pow1[i] = (pow1[i-1] * BASE) % MOD1;
        pow2[i] = (pow2[i-1] * BASE) % MOD2;
    }

    for (int i = 0; i < n; i++) {
        long long c = s[i] - 'a' + 1;

        pref1[i+1] = (pref1[i] * BASE + c) % MOD1;
        pref2[i+1] = (pref2[i] * BASE + c) % MOD2;
    }
}

// –ü–æ–ª—É—á–∏—Ç—å —Ö–µ—à –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ [l, r]
pair<long long, long long> get_hash(int l, int r) {
    long long h1 = (pref1[r+1] - (pref1[l] * pow1[r - l + 1]) % MOD1 + MOD1) % MOD1;
    long long h2 = (pref2[r+1] - (pref2[l] * pow2[r - l + 1]) % MOD2 + MOD2) % MOD2;
    return {h1, h2};
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
int main() {
    s = "abacaba";
    build_hashes();

    auto h1 = get_hash(0, 2);  // "aba"
    auto h2 = get_hash(4, 6);  // "aba"

    if (h1 == h2) {
        cout << "–ü–æ–¥—Å—Ç—Ä–æ–∫–∏ —Ä–∞–≤–Ω—ã!" << endl;
    }

    return 0;
}
```
---
## üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```cpp
int main() {
    string str = "abacaba";
    DoubleHashedString hstr(str);

    auto hash1 = hstr.get_hash(0, 2);  // "aba"
    auto hash2 = hstr.get_hash(4, 6);  // "aba"

    if (hash1 == hash2) {
        cout << "–ü–æ–¥—Å—Ç—Ä–æ–∫–∏ —Ä–∞–≤–Ω—ã!" << endl;
    }

    return 0;
}
```

---

## üîπ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –∑–∞–¥–∞—á–∞—Ö

| –ó–∞–¥–∞—á–∞                       | –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–µ—à–∏                                                         |
| ---------------------------- | ----------------------------------------------------------------------------- |
| **–ü–æ–∏—Å–∫ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏**          | –ê–ª–≥–æ—Ä–∏—Ç–º –†–∞–±–∏–Ω–∞-–ö–∞—Ä–ø–∞: —Å—Ä–∞–≤–Ω–∏–≤–∞–π —Ö–µ—à —à–∞–±–ª–æ–Ω–∞ —Å —Ö–µ—à–∞–º–∏ –≤—Å–µ—Ö –ø–æ–¥—Å—Ç—Ä–æ–∫ –¥–ª–∏–Ω—ã `m` |
| **–ù–∞–∏–±–æ–ª—å—à–∏–π –æ–±—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å** | –ë–∏–Ω–ø–æ–∏—Å–∫ –ø–æ –¥–ª–∏–Ω–µ + —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö–µ—à–µ–π                                           |
| **–ü–∞–ª–∏–Ω–¥—Ä–æ–º?**               | –°—Ä–∞–≤–Ω–∏ —Ö–µ—à —Å—Ç—Ä–æ–∫–∏ –∏ —Ö–µ—à –µ—ë –æ–±—Ä–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏                                    |
| **–†–∞–∑–Ω—ã–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏**         | –î–æ–±–∞–≤–ª—è–π —Ö–µ—à–∏ –≤—Å–µ—Ö –ø–æ–¥—Å—Ç—Ä–æ–∫ –≤ `set`                                           |
| **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–¥–≤–∏–≥–∏**       | –°—Ä–∞–≤–Ω–∏–≤–∞–π —Ö–µ—à–∏ —Å–¥–≤–∏–Ω—É—Ç—ã—Ö –≤–µ—Ä—Å–∏–π                                               |

---

## üîπ –°–æ–≤–µ—Ç—ã

- ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π **–¥–≤–æ–π–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö.
- ‚úÖ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `0` –¥–ª—è —Å–∏–º–≤–æ–ª–æ–≤ ‚Äî –∏–Ω–∞—á–µ `a` –∏ `aa` –º–æ–≥—É—Ç —Å–æ–≤–ø–∞—Å—Ç—å.
- ‚úÖ –î–µ–ª–∞–π `(x % mod + mod) % mod` –ø—Ä–∏ –≤—ã—á–∏—Ç–∞–Ω–∏–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
- ‚úÖ –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ñ—Ä—ã/–∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã, —Ä–∞—Å—à–∏—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤:
  ```cpp
  long long char_val;
  if (c >= 'a' && c <= 'z') char_val = c - 'a' + 1;
  else if (c >= 'A' && c <= 'Z') char_val = c - 'A' + 27;
  else if (c >= '0' && c <= '9') char_val = c - '0' + 53;
  ```
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π `long long`, –Ω–æ —Å–ª–µ–¥–∏ –∑–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø—Ä–∏ —É–º–Ω–æ–∂–µ–Ω–∏–∏.

---

## üîπ –°–ª–æ–∂–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è |
|--------|------|
| –ü—Ä–µ–¥–ø–æ–¥—Å—á—ë—Ç |$O(n)$|
| –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–µ—à–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ |$O(1)$|
| –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–¥—Å—Ç—Ä–æ–∫ |$O(1)$|

---

## üîπ –°—Å—ã–ª–∫–∏ –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏

- [Codeforces: "Good Substrings"](https://codeforces.com/problemset/problem/271/D)
- [SPOJ: SUB_PROB](https://www.spoj.com/problems/SUB_PROB/)
- [LeetCode: Longest Happy Prefix](https://leetcode.com/problems/longest-happy-prefix/)

---

> üí° **–ó–∞–ø–æ–º–Ω–∏:** —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –Ω–µ –ø–∞–Ω–∞—Ü–µ—è, –Ω–æ —Å –¥–≤–æ–π–Ω—ã–º –º–æ–¥—É–ª–µ–º –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –æ–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∫ –∏–¥–µ–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫**.

--- 

üìå **–¢–µ–≥–∏:** #—Å—Ç—Ä–æ–∫–∏ #—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ #—Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ #–∞–ª–≥–æ—Ä–∏—Ç–º—ã #Cpp #ObsidianNote